<%- model_class = Topic -%>
<div id="container-topic" class="container-topic intro-effect-fadeout">

    <!--div class="codrops-top clearfix">
    	<a class="codrops-icon codrops-icon-prev" href="http://tympanus.net/Tutorials/SamsungGrid/"><span>Previous Demo</span></a>
    	<span class="right"><a class="codrops-icon codrops-icon-drop" href="http://tympanus.net/codrops/?p=19119"><span>Back to the Codrops Article</span></a></span>
    </div-->
    <header class="header">
        <% if @category_role %>
        	<div class="bg-img"><%= image_tag @character.image_url %></div>
        	<div class="title">
        		<!--nav class="codrops-demos">
        			<a href="index.html">Push</a>
        			<a class="current-demo" href="index2.html">Fade Out</a>
        		</nav-->
        		<h1>
        		    <%= @character.name %>
        		    <br>
        		    <small><%= @character.quote %></small>
        		</h1>
        		<% unless @character.summary.blank? %>
        		<p class="subline"><%= @character.summary %></p>
        		<% end %>
        		<% unless @character.anecdote.blank? %>
        		<p><%= model_class.human_attribute_name(:anecdote) %> : <%= @character.anecdote %></p>
        		<% end %>
        	</div>
        <% else %>
        	<div class="bg-img"><%= image_tag @topic.image_url %></div>
        	<div class="title">
        		<!--nav class="codrops-demos">
        			<a href="index.html">Push</a>
        			<a class="current-demo" href="index2.html">Fade Out</a>
        		</nav-->
        		<h1><%= @topic.title %><br><small><%= @topic.subtitle %></small></h1>
        		<p class="subline"><%= @topic.summary %></p>
        		<% unless @topic.weather.blank? %>
        		<p><%= model_class.human_attribute_name(:weather) %> : <%= @topic.weather %></p>
        		<% end %>
        	</div>
    	<% end %>
    </header>
    <button class="trigger" data-info="Voir les posts"><span>Posts</span></button>
    <article class="content">
        <div>
            <% if @category_role == :character %>
                <div class="row">
    		        <div class="col-md-6">
    		            <%=l @character.created_at %>
                    </div><div class="col-md-6" style="text-align: right">
                        <% if can? :manage, @character %>
                        <%= link_to t('.edit_character', :default => t("helpers.links.edit")),
                                      edit_user_character_path(@character, user_id: current_user), :class => 'btn btn-default btn-xs' %> 
                        <% end %>
                    </div>
    		    </div>
    		    <div class="row">
    		        <div class="col-md-3">
    		            <div class="thumbnail">
        		            <%= image_tag(@character.avatar_url) if @character.avatar_url %>
        		            <div class="caption">
        		                <h3 style="color: <%= @character.faction.color %>"><%= @character.name %></h3>
        		            </div>
    		            </div>
    		        </div>
    		        <div class="col-md-9">
    		            <% unless @character.story.blank? %>
    		            <h1><%= Character.human_attribute_name(:story) %></h1>
    		            <p style="text-align: justify">
    		                <%= sanitize @character.story.gsub(/\n/,"<br/>"), 
    		                :tags => %w(table tr td br b i span p blockquote img div) %>
                        </p>
                        <% end %>
    		            <% unless @character.appearance.blank? %>
    		            <h1><%= Character.human_attribute_name(:appearance) %></h1>
    		            <p style="text-align: justify">
    		                <%= sanitize @character.appearance.gsub(/\n/,"<br/>"), 
    		                :tags => %w(table tr td br b i span p blockquote img div) %>
                        </p>
                        <% end %>
    		            <% unless @character.psychology.blank? %>
    		            <h1><%= Character.human_attribute_name(:psychology) %></h1>
    		            <p style="text-align: justify">
    		                <%= sanitize @character.psychology.gsub(/\n/,"<br/>"), 
    		                :tags => %w(table tr td br b i span p blockquote img div) %>
                        </p>
                        <% end %>
    		        </div>
    		    </div>
    		    <hr />
            <% elsif @category.special_role == :links %>
                <div class="row">
    		        <div class="col-md-6">
    		            <%=l @character.created_at %>
                    </div><div class="col-md-6" style="text-align: right">
                        <% if user_signed_in? %>
                        <%= link_to t('.edit_links', :default => t("helpers.links.edit")),
                                      graph_links_path, :class => 'btn btn-default btn-xs' %> 
                        <% end %>
                    </div>
    		    </div>
    		    <div class="row">
    		        <div class="col-md-3">
    		            <div class="thumbnail">
        		            <%= image_tag(@character.avatar_url) if @character.avatar_url %>
        		            <div class="caption">
        		                <h3 style="color: <%= @character.faction.color %>"><%= @character.name %></h3>
        		            </div>
    		            </div>
    		        </div>
    		        <div class="col-md-9">
		                <table class="character-links">
                          <% @links.order('force DESC').each do |l| %> <!--# Sorted by force, desc-->
                            <% other = if l.to_character_id == @character.id then l.from_character else l.to_character end %>
                            <tr>
                              <td>
                                <%= image_tag other.small_image_url, class: "graph-avatar-link" %>
                              </td>
                              <td>
                                <div class="text-center">
                                  <h4>
                                    <%= link_to other.name, other.links_topic, style: "color: " + other.faction.color %>
                                    <br />
                                    <small style="color: <%= l.link_nature.color %>"><%= l.link_nature.name %></small>
                                  </h4>
                                </div>
                                
                                <% if !l.title.blank? %>
                                  <h3><%= l.title %></h3>
                                <% end %>
                                <% if !l.description.blank? %>
                                  <p><%= l.description %></p>
                                <% end %>
                              </td>
                            </tr>
                          <% end %>
                        </table>
    		        </div>
    		    </div>
    		    <hr />
            <% elsif @category.special_role == :rps %>
                TODO
            <% end %>
    		<% @answers.each do |answer| %>
    		    <div class="row">
    		        <div class="col-md-6">
    		            <%=l answer.created_at %>
                    </div>
                    <div class="col-md-6" style="text-align: right">
                        <% if can? :manage, answer %>
                        <%= link_to t('.edit_answer', :default => t("helpers.links.edit")),
                                      edit_answer_path(answer), :class => 'btn btn-default btn-xs' %>
                        <%= link_to t('.destroy_answer', :default => t("helpers.links.destroy")),
                                      answer_path(answer),
                                      :method => 'delete',
                                      :data => { :confirm => t('.confirm_answer', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                                      :class => 'btn btn-danger btn-xs' %>
                        <% end %>
                    </div>
    		    </div>
    		    <div class="row">
    		        <div class="col-md-3">
    		            <div class="thumbnail">
    		                <% if answer.character %>
        		            <%= image_tag(answer.character.avatar_url) if answer.character.avatar_url %>
        		            <div class="caption">
        		                <h3 style="color: <%= answer.character.faction.color %>"><%= answer.character %></h3>
        		            </div>
        		            <% else %>
        		            <div class="caption">
        		                <h3 style="color: grey"><%=t t('.deleted_character') %></h3>
        		            </div>
        		            <% end %>
    		            </div>
    		        </div>
    		        <div class="col-md-9">
    		            <% unless answer.title.blank? %>
    		            <h1><%= answer.title %></h1>
    		            <% end %>
    		            <% unless answer.content.blank? %>
    		            <span style="text-align: justify">
    		                <%= sanitize answer.content.gsub(/\n/,"<br/>"), 
    		                :tags => %w(table tr td br b i span p blockquote img div) %>
                        </span>
                        <% end %>
    		        </div>
    		    </div>
    		    <hr />
    		<% end %>
    	</div>
    </article>
    <section class="related">
        <%= link_to t('.back', :default => t("helpers.links.back")),
                      topic_back_url(@topic), :class => 'btn btn-default'  %>
        <% if @topic.character and @topic.character.user == current_user %>
        <%= link_to t('characters'),
                      user_characters_path(current_user), :class => 'btn btn-default'  %>
        <% else %>
        <%= link_to t('members'),
                      characters_path, :class => 'btn btn-default'  %>
        <% end %>
        <% if can? :create, @topic.answers.new %>
        <%= link_to t('.answer'),
                      new_answer_path(topic_id: @topic), :class => 'btn btn-default' %>
        <% end %>
        <% if can? :manage, @topic %>
        <%= link_to t('.edit', :default => t("helpers.links.edit")),
                      edit_topic_path(@topic), :class => 'btn btn-default' %>
        <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                      topic_path(@topic),
                      :method => 'delete',
                      :data => { :confirm => t('.confirm_topic', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                      :class => 'btn btn-danger' %>
        <% end %>
    </section>
</div>